<div class="container-xl top">
  <app-header title="Import Cards from CSV"></app-header>
</div>
<style>
  .hero-sticky-container {
    overflow: visible;
  }

  .sticky-table {
    position: sticky;
    top: 0;

    td {
      padding: 0 6px;
    }

    th {
      padding: 6px;
      backdrop-filter: blur(3px);
      position: sticky;
      top: 0;
      z-index: 1;
    }
  }
</style>
<div class="container">
  <div class="hero hero-sticky-container">
    <div>
      <div *ngIf="loadingDecks" class="text-center">
        <ion-spinner name="dots" class="mr-1"></ion-spinner>Loading decks...
      </div>
      <ng-container *ngIf="!loadingDecks">
        <ng-container *ngIf="selectedDeck$ | async as selectedDeck">
          <ng-container *ngIf="!selectedDeck">
            <div class="lead-2 text-center text-emphasize mb-2">
              What language would you like to import?
            </div>
            <app-language-input
              [value]="selectedDeck"
              (onChange)="selectedDeck$.next($event)"
            ></app-language-input>
          </ng-container>
          <ng-container *ngIf="selectedDeck">
            <div class="mb-1">
              Import cards for

              <app-deck-selector
                style="
                  display: inline-flex;
                  margin-top: -6px;
                  margin-left: 0.5rem;
                "
                [value]="selectedDeck"
                [languages]="languages"
                (change)="selectedDeck$.next($event)"
              ></app-deck-selector>
            </div>
            <div class="mb-1">
              The CSV file is expected to contain word and translation columns.
            </div>
            <div class="mb-1">
              <button
                mat-button
                color="accent"
                mat-flat-button
                class="mr-0_5"
                (click)="fileInput.click()"
              >
                <mat-icon class="middle mr-0_5">upload</mat-icon
                ><span class="middle">Upload CSV</span>
              </button>
              <input
                hidden
                #fileInput
                type="file"
                (change)="onFileChange($event.target)"
                accept=".csv,.txt"
              />
              or paste the CSV file contents below:
            </div>

            <div class="mb-1">
              <textarea
                #contents
                [(ngModel)]="csv"
                (input)="onCsvChange()"
                style="
                  width: 100%;
                  resize: vertical;
                  height: 10rem;
                  font-size: 0.9rem;
                  white-space: pre;
                  tab-size: 4;
                  overflow-wrap: normal;
                  overflow-x: scroll;
                  font-family: monospace;
                "
                wrap="off"
              ></textarea>
            </div>

            <div>
              <app-tags-selector [tags]="deckTags"></app-tags-selector>
            </div>
          </ng-container>

          <table *ngIf="csvData.length > 0" class="mt-1 mb-2 sticky-table">
            <tr>
              <th class="text-left"></th>
              <th class="text-left">Word/Phrase</th>
              <th class="text-left">Translation</th>
            </tr>
            <tr *ngFor="let cardRow of csvData; let i = index">
              <td>{{ i + 1 }}.</td>
              <td>{{ cardRow.source }}</td>
              <td>{{ cardRow.translation }}</td>
            </tr>
          </table>
        </ng-container>
      </ng-container>
    </div>
  </div>
</div>
